!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).mapboxglFlatgeobuf=e()}(this,function(){"use strict";var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function e(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function n(t,e){return t(e={exports:{}},e.exports),e.exports}function r(t){return t&&t.default||t}var i=n(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){return function(t,e,n,r,i,o,s,a,u,f){this.name=t,this.type=e,this.title=n,this.description=r,this.width=i,this.precision=o,this.scale=s,this.nullable=a,this.unique=u,this.primary_key=f}}();e.default=n});e(i);var o={SIZEOF_SHORT:2,SIZEOF_INT:4,FILE_IDENTIFIER_LENGTH:4,SIZE_PREFIX_LENGTH:4,Encoding:{UTF8_BYTES:1,UTF16_STRING:2}};o.int32=new Int32Array(2),o.float32=new Float32Array(o.int32.buffer),o.float64=new Float64Array(o.int32.buffer),o.isLittleEndian=1===new Uint16Array(new Uint8Array([1,0]).buffer)[0],o.Long=function(t,e){this.low=0|t,this.high=0|e},o.Long.create=function(t,e){return 0==t&&0==e?o.Long.ZERO:new o.Long(t,e)},o.Long.prototype.toFloat64=function(){return(this.low>>>0)+4294967296*this.high},o.Long.prototype.equals=function(t){return this.low==t.low&&this.high==t.high},o.Long.ZERO=new o.Long(0,0),o.Builder=function(t){if(t)e=t;else var e=1024;this.bb=o.ByteBuffer.allocate(e),this.space=e,this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1},o.Builder.prototype.clear=function(){this.bb.clear(),this.space=this.bb.capacity(),this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1},o.Builder.prototype.forceDefaults=function(t){this.force_defaults=t},o.Builder.prototype.dataBuffer=function(){return this.bb},o.Builder.prototype.asUint8Array=function(){return this.bb.bytes().subarray(this.bb.position(),this.bb.position()+this.offset())},o.Builder.prototype.prep=function(t,e){t>this.minalign&&(this.minalign=t);for(var n=1+~(this.bb.capacity()-this.space+e)&t-1;this.space<n+t+e;){var r=this.bb.capacity();this.bb=o.Builder.growByteBuffer(this.bb),this.space+=this.bb.capacity()-r}this.pad(n)},o.Builder.prototype.pad=function(t){for(var e=0;e<t;e++)this.bb.writeInt8(--this.space,0)},o.Builder.prototype.writeInt8=function(t){this.bb.writeInt8(this.space-=1,t)},o.Builder.prototype.writeInt16=function(t){this.bb.writeInt16(this.space-=2,t)},o.Builder.prototype.writeInt32=function(t){this.bb.writeInt32(this.space-=4,t)},o.Builder.prototype.writeInt64=function(t){this.bb.writeInt64(this.space-=8,t)},o.Builder.prototype.writeFloat32=function(t){this.bb.writeFloat32(this.space-=4,t)},o.Builder.prototype.writeFloat64=function(t){this.bb.writeFloat64(this.space-=8,t)},o.Builder.prototype.addInt8=function(t){this.prep(1,0),this.writeInt8(t)},o.Builder.prototype.addInt16=function(t){this.prep(2,0),this.writeInt16(t)},o.Builder.prototype.addInt32=function(t){this.prep(4,0),this.writeInt32(t)},o.Builder.prototype.addInt64=function(t){this.prep(8,0),this.writeInt64(t)},o.Builder.prototype.addFloat32=function(t){this.prep(4,0),this.writeFloat32(t)},o.Builder.prototype.addFloat64=function(t){this.prep(8,0),this.writeFloat64(t)},o.Builder.prototype.addFieldInt8=function(t,e,n){(this.force_defaults||e!=n)&&(this.addInt8(e),this.slot(t))},o.Builder.prototype.addFieldInt16=function(t,e,n){(this.force_defaults||e!=n)&&(this.addInt16(e),this.slot(t))},o.Builder.prototype.addFieldInt32=function(t,e,n){(this.force_defaults||e!=n)&&(this.addInt32(e),this.slot(t))},o.Builder.prototype.addFieldInt64=function(t,e,n){!this.force_defaults&&e.equals(n)||(this.addInt64(e),this.slot(t))},o.Builder.prototype.addFieldFloat32=function(t,e,n){(this.force_defaults||e!=n)&&(this.addFloat32(e),this.slot(t))},o.Builder.prototype.addFieldFloat64=function(t,e,n){(this.force_defaults||e!=n)&&(this.addFloat64(e),this.slot(t))},o.Builder.prototype.addFieldOffset=function(t,e,n){(this.force_defaults||e!=n)&&(this.addOffset(e),this.slot(t))},o.Builder.prototype.addFieldStruct=function(t,e,n){e!=n&&(this.nested(e),this.slot(t))},o.Builder.prototype.nested=function(t){if(t!=this.offset())throw new Error("FlatBuffers: struct must be serialized inline.")},o.Builder.prototype.notNested=function(){if(this.isNested)throw new Error("FlatBuffers: object serialization must not be nested.")},o.Builder.prototype.slot=function(t){this.vtable[t]=this.offset()},o.Builder.prototype.offset=function(){return this.bb.capacity()-this.space},o.Builder.growByteBuffer=function(t){var e=t.capacity();if(3221225472&e)throw new Error("FlatBuffers: cannot grow buffer beyond 2 gigabytes.");var n=e<<1,r=o.ByteBuffer.allocate(n);return r.setPosition(n-e),r.bytes().set(t.bytes(),n-e),r},o.Builder.prototype.addOffset=function(t){this.prep(o.SIZEOF_INT,0),this.writeInt32(this.offset()-t+o.SIZEOF_INT)},o.Builder.prototype.startObject=function(t){this.notNested(),null==this.vtable&&(this.vtable=[]),this.vtable_in_use=t;for(var e=0;e<t;e++)this.vtable[e]=0;this.isNested=!0,this.object_start=this.offset()},o.Builder.prototype.endObject=function(){if(null==this.vtable||!this.isNested)throw new Error("FlatBuffers: endObject called without startObject");this.addInt32(0);for(var t=this.offset(),e=this.vtable_in_use-1;e>=0&&0==this.vtable[e];e--);for(var n=e+1;e>=0;e--)this.addInt16(0!=this.vtable[e]?t-this.vtable[e]:0);this.addInt16(t-this.object_start);var r=(n+2)*o.SIZEOF_SHORT;this.addInt16(r);var i=0,s=this.space;t:for(e=0;e<this.vtables.length;e++){var a=this.bb.capacity()-this.vtables[e];if(r==this.bb.readInt16(a)){for(var u=o.SIZEOF_SHORT;u<r;u+=o.SIZEOF_SHORT)if(this.bb.readInt16(s+u)!=this.bb.readInt16(a+u))continue t;i=this.vtables[e];break}}return i?(this.space=this.bb.capacity()-t,this.bb.writeInt32(this.space,i-t)):(this.vtables.push(this.offset()),this.bb.writeInt32(this.bb.capacity()-t,this.offset()-t)),this.isNested=!1,t},o.Builder.prototype.finish=function(t,e,n){var r=n?o.SIZE_PREFIX_LENGTH:0;if(e){var i=e;if(this.prep(this.minalign,o.SIZEOF_INT+o.FILE_IDENTIFIER_LENGTH+r),i.length!=o.FILE_IDENTIFIER_LENGTH)throw new Error("FlatBuffers: file identifier must be length "+o.FILE_IDENTIFIER_LENGTH);for(var s=o.FILE_IDENTIFIER_LENGTH-1;s>=0;s--)this.writeInt8(i.charCodeAt(s))}this.prep(this.minalign,o.SIZEOF_INT+r),this.addOffset(t),r&&this.addInt32(this.bb.capacity()-this.space),this.bb.setPosition(this.space)},o.Builder.prototype.finishSizePrefixed=function(t,e){this.finish(t,e,!0)},o.Builder.prototype.requiredField=function(t,e){var n=this.bb.capacity()-t,r=n-this.bb.readInt32(n);if(!(0!=this.bb.readInt16(r+e)))throw new Error("FlatBuffers: field "+e+" must be set")},o.Builder.prototype.startVector=function(t,e,n){this.notNested(),this.vector_num_elems=e,this.prep(o.SIZEOF_INT,t*e),this.prep(n,t*e)},o.Builder.prototype.endVector=function(){return this.writeInt32(this.vector_num_elems),this.offset()},o.Builder.prototype.createString=function(t){if(t instanceof Uint8Array)var e=t;else{e=[];for(var n=0;n<t.length;){var r,i=t.charCodeAt(n++);if(i<55296||i>=56320)r=i;else r=(i<<10)+t.charCodeAt(n++)+-56613888;r<128?e.push(r):(r<2048?e.push(r>>6&31|192):(r<65536?e.push(r>>12&15|224):e.push(r>>18&7|240,r>>12&63|128),e.push(r>>6&63|128)),e.push(63&r|128))}}this.addInt8(0),this.startVector(1,e.length,1),this.bb.setPosition(this.space-=e.length);n=0;for(var o=this.space,s=this.bb.bytes();n<e.length;n++)s[o++]=e[n];return this.endVector()},o.Builder.prototype.createLong=function(t,e){return o.Long.create(t,e)},o.ByteBuffer=function(t){this.bytes_=t,this.position_=0},o.ByteBuffer.allocate=function(t){return new o.ByteBuffer(new Uint8Array(t))},o.ByteBuffer.prototype.clear=function(){this.position_=0},o.ByteBuffer.prototype.bytes=function(){return this.bytes_},o.ByteBuffer.prototype.position=function(){return this.position_},o.ByteBuffer.prototype.setPosition=function(t){this.position_=t},o.ByteBuffer.prototype.capacity=function(){return this.bytes_.length},o.ByteBuffer.prototype.readInt8=function(t){return this.readUint8(t)<<24>>24},o.ByteBuffer.prototype.readUint8=function(t){return this.bytes_[t]},o.ByteBuffer.prototype.readInt16=function(t){return this.readUint16(t)<<16>>16},o.ByteBuffer.prototype.readUint16=function(t){return this.bytes_[t]|this.bytes_[t+1]<<8},o.ByteBuffer.prototype.readInt32=function(t){return this.bytes_[t]|this.bytes_[t+1]<<8|this.bytes_[t+2]<<16|this.bytes_[t+3]<<24},o.ByteBuffer.prototype.readUint32=function(t){return this.readInt32(t)>>>0},o.ByteBuffer.prototype.readInt64=function(t){return new o.Long(this.readInt32(t),this.readInt32(t+4))},o.ByteBuffer.prototype.readUint64=function(t){return new o.Long(this.readUint32(t),this.readUint32(t+4))},o.ByteBuffer.prototype.readFloat32=function(t){return o.int32[0]=this.readInt32(t),o.float32[0]},o.ByteBuffer.prototype.readFloat64=function(t){return o.int32[o.isLittleEndian?0:1]=this.readInt32(t),o.int32[o.isLittleEndian?1:0]=this.readInt32(t+4),o.float64[0]},o.ByteBuffer.prototype.writeInt8=function(t,e){this.bytes_[t]=e},o.ByteBuffer.prototype.writeUint8=function(t,e){this.bytes_[t]=e},o.ByteBuffer.prototype.writeInt16=function(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8},o.ByteBuffer.prototype.writeUint16=function(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8},o.ByteBuffer.prototype.writeInt32=function(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8,this.bytes_[t+2]=e>>16,this.bytes_[t+3]=e>>24},o.ByteBuffer.prototype.writeUint32=function(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8,this.bytes_[t+2]=e>>16,this.bytes_[t+3]=e>>24},o.ByteBuffer.prototype.writeInt64=function(t,e){this.writeInt32(t,e.low),this.writeInt32(t+4,e.high)},o.ByteBuffer.prototype.writeUint64=function(t,e){this.writeUint32(t,e.low),this.writeUint32(t+4,e.high)},o.ByteBuffer.prototype.writeFloat32=function(t,e){o.float32[0]=e,this.writeInt32(t,o.int32[0])},o.ByteBuffer.prototype.writeFloat64=function(t,e){o.float64[0]=e,this.writeInt32(t,o.int32[o.isLittleEndian?0:1]),this.writeInt32(t+4,o.int32[o.isLittleEndian?1:0])},o.ByteBuffer.prototype.getBufferIdentifier=function(){if(this.bytes_.length<this.position_+o.SIZEOF_INT+o.FILE_IDENTIFIER_LENGTH)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");for(var t="",e=0;e<o.FILE_IDENTIFIER_LENGTH;e++)t+=String.fromCharCode(this.readInt8(this.position_+o.SIZEOF_INT+e));return t},o.ByteBuffer.prototype.__offset=function(t,e){var n=t-this.readInt32(t);return e<this.readInt16(n)?this.readInt16(n+e):0},o.ByteBuffer.prototype.__union=function(t,e){return t.bb_pos=e+this.readInt32(e),t.bb=this,t},o.ByteBuffer.prototype.__string=function(t,e){t+=this.readInt32(t);var n=this.readInt32(t),r="",i=0;if(t+=o.SIZEOF_INT,e===o.Encoding.UTF8_BYTES)return this.bytes_.subarray(t,t+n);for(;i<n;){var s,a=this.readUint8(t+i++);if(a<192)s=a;else{var u=this.readUint8(t+i++);if(a<224)s=(31&a)<<6|63&u;else{var f=this.readUint8(t+i++);if(a<240)s=(15&a)<<12|(63&u)<<6|63&f;else s=(7&a)<<18|(63&u)<<12|(63&f)<<6|63&this.readUint8(t+i++)}}s<65536?r+=String.fromCharCode(s):(s-=65536,r+=String.fromCharCode(55296+(s>>10),56320+(1023&s)))}return r},o.ByteBuffer.prototype.__indirect=function(t){return t+this.readInt32(t)},o.ByteBuffer.prototype.__vector=function(t){return t+this.readInt32(t)+o.SIZEOF_INT},o.ByteBuffer.prototype.__vector_len=function(t){return this.readInt32(t+this.readInt32(t))},o.ByteBuffer.prototype.__has_identifier=function(t){if(t.length!=o.FILE_IDENTIFIER_LENGTH)throw new Error("FlatBuffers: file identifier must be length "+o.FILE_IDENTIFIER_LENGTH);for(var e=0;e<o.FILE_IDENTIFIER_LENGTH;e++)if(t.charCodeAt(e)!=this.readInt8(this.position_+o.SIZEOF_INT+e))return!1;return!0},o.ByteBuffer.prototype.createLong=function(t,e){return o.Long.create(t,e)};var s=r(Object.freeze({__proto__:null,flatbuffers:o})),a=n(function(t,e){var n,r;Object.defineProperty(e,"__esModule",{value:!0}),e.Header=e.Crs=e.Column=e.ColumnType=e.GeometryType=void 0,function(t){t[t.Unknown=0]="Unknown",t[t.Point=1]="Point",t[t.LineString=2]="LineString",t[t.Polygon=3]="Polygon",t[t.MultiPoint=4]="MultiPoint",t[t.MultiLineString=5]="MultiLineString",t[t.MultiPolygon=6]="MultiPolygon",t[t.GeometryCollection=7]="GeometryCollection",t[t.CircularString=8]="CircularString",t[t.CompoundCurve=9]="CompoundCurve",t[t.CurvePolygon=10]="CurvePolygon",t[t.MultiCurve=11]="MultiCurve",t[t.MultiSurface=12]="MultiSurface",t[t.Curve=13]="Curve",t[t.Surface=14]="Surface",t[t.PolyhedralSurface=15]="PolyhedralSurface",t[t.TIN=16]="TIN",t[t.Triangle=17]="Triangle"}(n=e.GeometryType||(e.GeometryType={})),function(t){t[t.Byte=0]="Byte",t[t.UByte=1]="UByte",t[t.Bool=2]="Bool",t[t.Short=3]="Short",t[t.UShort=4]="UShort",t[t.Int=5]="Int",t[t.UInt=6]="UInt",t[t.Long=7]="Long",t[t.ULong=8]="ULong",t[t.Float=9]="Float",t[t.Double=10]="Double",t[t.String=11]="String",t[t.Json=12]="Json",t[t.DateTime=13]="DateTime",t[t.Binary=14]="Binary"}(r=e.ColumnType||(e.ColumnType={}));var i=function(){function t(){this.bb=null,this.bb_pos=0}return t.prototype.__init=function(t,e){return this.bb_pos=t,this.bb=e,this},t.getRoot=function(e,n){return(n||new t).__init(e.readInt32(e.position())+e.position(),e)},t.getSizePrefixedRoot=function(e,n){return e.setPosition(e.position()+s.flatbuffers.SIZE_PREFIX_LENGTH),(n||new t).__init(e.readInt32(e.position())+e.position(),e)},t.prototype.name=function(t){var e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null},t.prototype.type=function(){var t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readUint8(this.bb_pos+t):r.Byte},t.prototype.title=function(t){var e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__string(this.bb_pos+e,t):null},t.prototype.description=function(t){var e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__string(this.bb_pos+e,t):null},t.prototype.width=function(){var t=this.bb.__offset(this.bb_pos,12);return t?this.bb.readInt32(this.bb_pos+t):-1},t.prototype.precision=function(){var t=this.bb.__offset(this.bb_pos,14);return t?this.bb.readInt32(this.bb_pos+t):-1},t.prototype.scale=function(){var t=this.bb.__offset(this.bb_pos,16);return t?this.bb.readInt32(this.bb_pos+t):-1},t.prototype.nullable=function(){var t=this.bb.__offset(this.bb_pos,18);return!t||!!this.bb.readInt8(this.bb_pos+t)},t.prototype.unique=function(){var t=this.bb.__offset(this.bb_pos,20);return!!t&&!!this.bb.readInt8(this.bb_pos+t)},t.prototype.primaryKey=function(){var t=this.bb.__offset(this.bb_pos,22);return!!t&&!!this.bb.readInt8(this.bb_pos+t)},t.prototype.metadata=function(t){var e=this.bb.__offset(this.bb_pos,24);return e?this.bb.__string(this.bb_pos+e,t):null},t.start=function(t){t.startObject(11)},t.addName=function(t,e){t.addFieldOffset(0,e,0)},t.addType=function(t,e){t.addFieldInt8(1,e,r.Byte)},t.addTitle=function(t,e){t.addFieldOffset(2,e,0)},t.addDescription=function(t,e){t.addFieldOffset(3,e,0)},t.addWidth=function(t,e){t.addFieldInt32(4,e,-1)},t.addPrecision=function(t,e){t.addFieldInt32(5,e,-1)},t.addScale=function(t,e){t.addFieldInt32(6,e,-1)},t.addNullable=function(t,e){t.addFieldInt8(7,+e,1)},t.addUnique=function(t,e){t.addFieldInt8(8,+e,0)},t.addPrimaryKey=function(t,e){t.addFieldInt8(9,+e,0)},t.addMetadata=function(t,e){t.addFieldOffset(10,e,0)},t.end=function(t){var e=t.endObject();return t.requiredField(e,4),e},t.create=function(e,n,r,i,o,s,a,u,f,d,b,l){return t.start(e),t.addName(e,n),t.addType(e,r),t.addTitle(e,i),t.addDescription(e,o),t.addWidth(e,s),t.addPrecision(e,a),t.addScale(e,u),t.addNullable(e,f),t.addUnique(e,d),t.addPrimaryKey(e,b),t.addMetadata(e,l),t.end(e)},t}();e.Column=i;var o=function(){function t(){this.bb=null,this.bb_pos=0}return t.prototype.__init=function(t,e){return this.bb_pos=t,this.bb=e,this},t.getRoot=function(e,n){return(n||new t).__init(e.readInt32(e.position())+e.position(),e)},t.getSizePrefixedRoot=function(e,n){return e.setPosition(e.position()+s.flatbuffers.SIZE_PREFIX_LENGTH),(n||new t).__init(e.readInt32(e.position())+e.position(),e)},t.prototype.org=function(t){var e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null},t.prototype.code=function(){var t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readInt32(this.bb_pos+t):0},t.prototype.name=function(t){var e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__string(this.bb_pos+e,t):null},t.prototype.description=function(t){var e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__string(this.bb_pos+e,t):null},t.prototype.wkt=function(t){var e=this.bb.__offset(this.bb_pos,12);return e?this.bb.__string(this.bb_pos+e,t):null},t.prototype.codeString=function(t){var e=this.bb.__offset(this.bb_pos,14);return e?this.bb.__string(this.bb_pos+e,t):null},t.start=function(t){t.startObject(6)},t.addOrg=function(t,e){t.addFieldOffset(0,e,0)},t.addCode=function(t,e){t.addFieldInt32(1,e,0)},t.addName=function(t,e){t.addFieldOffset(2,e,0)},t.addDescription=function(t,e){t.addFieldOffset(3,e,0)},t.addWkt=function(t,e){t.addFieldOffset(4,e,0)},t.addCodeString=function(t,e){t.addFieldOffset(5,e,0)},t.end=function(t){return t.endObject()},t.create=function(e,n,r,i,o,s,a){return t.start(e),t.addOrg(e,n),t.addCode(e,r),t.addName(e,i),t.addDescription(e,o),t.addWkt(e,s),t.addCodeString(e,a),t.end(e)},t}();e.Crs=o;var a=function(){function t(){this.bb=null,this.bb_pos=0}return t.prototype.__init=function(t,e){return this.bb_pos=t,this.bb=e,this},t.getRoot=function(e,n){return(n||new t).__init(e.readInt32(e.position())+e.position(),e)},t.getSizePrefixedRoot=function(e,n){return e.setPosition(e.position()+s.flatbuffers.SIZE_PREFIX_LENGTH),(n||new t).__init(e.readInt32(e.position())+e.position(),e)},t.prototype.name=function(t){var e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null},t.prototype.envelope=function(t){var e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readFloat64(this.bb.__vector(this.bb_pos+e)+8*t):0},t.prototype.envelopeLength=function(){var t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0},t.prototype.envelopeArray=function(){var t=this.bb.__offset(this.bb_pos,6);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null},t.prototype.geometryType=function(){var t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readUint8(this.bb_pos+t):n.Unknown},t.prototype.hasZ=function(){var t=this.bb.__offset(this.bb_pos,10);return!!t&&!!this.bb.readInt8(this.bb_pos+t)},t.prototype.hasM=function(){var t=this.bb.__offset(this.bb_pos,12);return!!t&&!!this.bb.readInt8(this.bb_pos+t)},t.prototype.hasT=function(){var t=this.bb.__offset(this.bb_pos,14);return!!t&&!!this.bb.readInt8(this.bb_pos+t)},t.prototype.hasTM=function(){var t=this.bb.__offset(this.bb_pos,16);return!!t&&!!this.bb.readInt8(this.bb_pos+t)},t.prototype.columns=function(t,e){var n=this.bb.__offset(this.bb_pos,18);return n?(e||new i).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+4*t),this.bb):null},t.prototype.columnsLength=function(){var t=this.bb.__offset(this.bb_pos,18);return t?this.bb.__vector_len(this.bb_pos+t):0},t.prototype.featuresCount=function(){var t=this.bb.__offset(this.bb_pos,20);return t?this.bb.readUint64(this.bb_pos+t):this.bb.createLong(0,0)},t.prototype.indexNodeSize=function(){var t=this.bb.__offset(this.bb_pos,22);return t?this.bb.readUint16(this.bb_pos+t):16},t.prototype.crs=function(t){var e=this.bb.__offset(this.bb_pos,24);return e?(t||new o).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null},t.prototype.title=function(t){var e=this.bb.__offset(this.bb_pos,26);return e?this.bb.__string(this.bb_pos+e,t):null},t.prototype.description=function(t){var e=this.bb.__offset(this.bb_pos,28);return e?this.bb.__string(this.bb_pos+e,t):null},t.prototype.metadata=function(t){var e=this.bb.__offset(this.bb_pos,30);return e?this.bb.__string(this.bb_pos+e,t):null},t.start=function(t){t.startObject(14)},t.addName=function(t,e){t.addFieldOffset(0,e,0)},t.addEnvelope=function(t,e){t.addFieldOffset(1,e,0)},t.createEnvelopeVector=function(t,e){t.startVector(8,e.length,8);for(var n=e.length-1;n>=0;n--)t.addFloat64(e[n]);return t.endVector()},t.startEnvelopeVector=function(t,e){t.startVector(8,e,8)},t.addGeometryType=function(t,e){t.addFieldInt8(2,e,n.Unknown)},t.addHasZ=function(t,e){t.addFieldInt8(3,+e,0)},t.addHasM=function(t,e){t.addFieldInt8(4,+e,0)},t.addHasT=function(t,e){t.addFieldInt8(5,+e,0)},t.addHasTM=function(t,e){t.addFieldInt8(6,+e,0)},t.addColumns=function(t,e){t.addFieldOffset(7,e,0)},t.createColumnsVector=function(t,e){t.startVector(4,e.length,4);for(var n=e.length-1;n>=0;n--)t.addOffset(e[n]);return t.endVector()},t.startColumnsVector=function(t,e){t.startVector(4,e,4)},t.addFeaturesCount=function(t,e){t.addFieldInt64(8,e,t.createLong(0,0))},t.addIndexNodeSize=function(t,e){t.addFieldInt16(9,e,16)},t.addCrs=function(t,e){t.addFieldOffset(10,e,0)},t.addTitle=function(t,e){t.addFieldOffset(11,e,0)},t.addDescription=function(t,e){t.addFieldOffset(12,e,0)},t.addMetadata=function(t,e){t.addFieldOffset(13,e,0)},t.end=function(t){return t.endObject()},t.finishBuffer=function(t,e){t.finish(e)},t.finishSizePrefixedBuffer=function(t,e){t.finish(e,void 0,!0)},t.create=function(e,n,r,i,o,s,a,u,f,d,b,l,c,h,p){return t.start(e),t.addName(e,n),t.addEnvelope(e,r),t.addGeometryType(e,i),t.addHasZ(e,o),t.addHasM(e,s),t.addHasT(e,a),t.addHasTM(e,u),t.addColumns(e,f),t.addFeaturesCount(e,d),t.addIndexNodeSize(e,b),t.addCrs(e,l),t.addTitle(e,c),t.addDescription(e,h),t.addMetadata(e,p),t.end(e)},t}();e.Header=a});e(a);a.Header,a.Crs,a.Column,a.ColumnType,a.GeometryType;var u=n(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){return function(t,e,n,r,i,o){this.org=t,this.code=e,this.name=n,this.description=r,this.wkt=i,this.code_string=o}}();e.default=n});e(u);var f=n(function(e,n){var r=t&&t.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(n,"__esModule",{value:!0});var o=r(i),s=r(u),f=function(){function t(t,e,n,r,i,o,s,a){this.geometryType=t,this.columns=e,this.featuresCount=n,this.indexNodeSize=r,this.crs=i,this.title=o,this.description=s,this.metadata=a}return t.fromByteBuffer=function(e){for(var n=a.Header.getRoot(e),r=n.featuresCount().toFloat64(),i=n.indexNodeSize(),u=[],f=0;f<n.columnsLength();f++){var d=n.columns(f);if(!d)throw new Error("Column unexpectedly missing");if(!d.name())throw new Error("Column name unexpectedly missing");u.push(new o.default(d.name(),d.type(),d.title(),d.description(),d.width(),d.precision(),d.scale(),d.nullable(),d.unique(),d.primaryKey()))}var b=n.crs(),l=b?new s.default(b.org(),b.code(),b.name(),b.description(),b.wkt(),b.codeString()):null;return new t(n.geometryType(),u,r,i,l,n.title(),n.description(),n.metadata())},t}();n.default=f});e(f);var d=n(function(t,e){var n,r;Object.defineProperty(e,"__esModule",{value:!0}),e.Feature=e.Geometry=e.Header=e.Crs=e.Column=e.ColumnType=e.GeometryType=void 0,function(t){t[t.Unknown=0]="Unknown",t[t.Point=1]="Point",t[t.LineString=2]="LineString",t[t.Polygon=3]="Polygon",t[t.MultiPoint=4]="MultiPoint",t[t.MultiLineString=5]="MultiLineString",t[t.MultiPolygon=6]="MultiPolygon",t[t.GeometryCollection=7]="GeometryCollection",t[t.CircularString=8]="CircularString",t[t.CompoundCurve=9]="CompoundCurve",t[t.CurvePolygon=10]="CurvePolygon",t[t.MultiCurve=11]="MultiCurve",t[t.MultiSurface=12]="MultiSurface",t[t.Curve=13]="Curve",t[t.Surface=14]="Surface",t[t.PolyhedralSurface=15]="PolyhedralSurface",t[t.TIN=16]="TIN",t[t.Triangle=17]="Triangle"}(n=e.GeometryType||(e.GeometryType={})),function(t){t[t.Byte=0]="Byte",t[t.UByte=1]="UByte",t[t.Bool=2]="Bool",t[t.Short=3]="Short",t[t.UShort=4]="UShort",t[t.Int=5]="Int",t[t.UInt=6]="UInt",t[t.Long=7]="Long",t[t.ULong=8]="ULong",t[t.Float=9]="Float",t[t.Double=10]="Double",t[t.String=11]="String",t[t.Json=12]="Json",t[t.DateTime=13]="DateTime",t[t.Binary=14]="Binary"}(r=e.ColumnType||(e.ColumnType={}));var i=function(){function t(){this.bb=null,this.bb_pos=0}return t.prototype.__init=function(t,e){return this.bb_pos=t,this.bb=e,this},t.getRoot=function(e,n){return(n||new t).__init(e.readInt32(e.position())+e.position(),e)},t.getSizePrefixedRoot=function(e,n){return e.setPosition(e.position()+s.flatbuffers.SIZE_PREFIX_LENGTH),(n||new t).__init(e.readInt32(e.position())+e.position(),e)},t.prototype.name=function(t){var e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null},t.prototype.type=function(){var t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readUint8(this.bb_pos+t):r.Byte},t.prototype.title=function(t){var e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__string(this.bb_pos+e,t):null},t.prototype.description=function(t){var e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__string(this.bb_pos+e,t):null},t.prototype.width=function(){var t=this.bb.__offset(this.bb_pos,12);return t?this.bb.readInt32(this.bb_pos+t):-1},t.prototype.precision=function(){var t=this.bb.__offset(this.bb_pos,14);return t?this.bb.readInt32(this.bb_pos+t):-1},t.prototype.scale=function(){var t=this.bb.__offset(this.bb_pos,16);return t?this.bb.readInt32(this.bb_pos+t):-1},t.prototype.nullable=function(){var t=this.bb.__offset(this.bb_pos,18);return!t||!!this.bb.readInt8(this.bb_pos+t)},t.prototype.unique=function(){var t=this.bb.__offset(this.bb_pos,20);return!!t&&!!this.bb.readInt8(this.bb_pos+t)},t.prototype.primaryKey=function(){var t=this.bb.__offset(this.bb_pos,22);return!!t&&!!this.bb.readInt8(this.bb_pos+t)},t.prototype.metadata=function(t){var e=this.bb.__offset(this.bb_pos,24);return e?this.bb.__string(this.bb_pos+e,t):null},t.start=function(t){t.startObject(11)},t.addName=function(t,e){t.addFieldOffset(0,e,0)},t.addType=function(t,e){t.addFieldInt8(1,e,r.Byte)},t.addTitle=function(t,e){t.addFieldOffset(2,e,0)},t.addDescription=function(t,e){t.addFieldOffset(3,e,0)},t.addWidth=function(t,e){t.addFieldInt32(4,e,-1)},t.addPrecision=function(t,e){t.addFieldInt32(5,e,-1)},t.addScale=function(t,e){t.addFieldInt32(6,e,-1)},t.addNullable=function(t,e){t.addFieldInt8(7,+e,1)},t.addUnique=function(t,e){t.addFieldInt8(8,+e,0)},t.addPrimaryKey=function(t,e){t.addFieldInt8(9,+e,0)},t.addMetadata=function(t,e){t.addFieldOffset(10,e,0)},t.end=function(t){var e=t.endObject();return t.requiredField(e,4),e},t.create=function(e,n,r,i,o,s,a,u,f,d,b,l){return t.start(e),t.addName(e,n),t.addType(e,r),t.addTitle(e,i),t.addDescription(e,o),t.addWidth(e,s),t.addPrecision(e,a),t.addScale(e,u),t.addNullable(e,f),t.addUnique(e,d),t.addPrimaryKey(e,b),t.addMetadata(e,l),t.end(e)},t}();e.Column=i;var o=function(){function t(){this.bb=null,this.bb_pos=0}return t.prototype.__init=function(t,e){return this.bb_pos=t,this.bb=e,this},t.getRoot=function(e,n){return(n||new t).__init(e.readInt32(e.position())+e.position(),e)},t.getSizePrefixedRoot=function(e,n){return e.setPosition(e.position()+s.flatbuffers.SIZE_PREFIX_LENGTH),(n||new t).__init(e.readInt32(e.position())+e.position(),e)},t.prototype.org=function(t){var e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null},t.prototype.code=function(){var t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readInt32(this.bb_pos+t):0},t.prototype.name=function(t){var e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__string(this.bb_pos+e,t):null},t.prototype.description=function(t){var e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__string(this.bb_pos+e,t):null},t.prototype.wkt=function(t){var e=this.bb.__offset(this.bb_pos,12);return e?this.bb.__string(this.bb_pos+e,t):null},t.prototype.codeString=function(t){var e=this.bb.__offset(this.bb_pos,14);return e?this.bb.__string(this.bb_pos+e,t):null},t.start=function(t){t.startObject(6)},t.addOrg=function(t,e){t.addFieldOffset(0,e,0)},t.addCode=function(t,e){t.addFieldInt32(1,e,0)},t.addName=function(t,e){t.addFieldOffset(2,e,0)},t.addDescription=function(t,e){t.addFieldOffset(3,e,0)},t.addWkt=function(t,e){t.addFieldOffset(4,e,0)},t.addCodeString=function(t,e){t.addFieldOffset(5,e,0)},t.end=function(t){return t.endObject()},t.create=function(e,n,r,i,o,s,a){return t.start(e),t.addOrg(e,n),t.addCode(e,r),t.addName(e,i),t.addDescription(e,o),t.addWkt(e,s),t.addCodeString(e,a),t.end(e)},t}();e.Crs=o;var a=function(){function t(){this.bb=null,this.bb_pos=0}return t.prototype.__init=function(t,e){return this.bb_pos=t,this.bb=e,this},t.getRoot=function(e,n){return(n||new t).__init(e.readInt32(e.position())+e.position(),e)},t.getSizePrefixedRoot=function(e,n){return e.setPosition(e.position()+s.flatbuffers.SIZE_PREFIX_LENGTH),(n||new t).__init(e.readInt32(e.position())+e.position(),e)},t.prototype.name=function(t){var e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null},t.prototype.envelope=function(t){var e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readFloat64(this.bb.__vector(this.bb_pos+e)+8*t):0},t.prototype.envelopeLength=function(){var t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0},t.prototype.envelopeArray=function(){var t=this.bb.__offset(this.bb_pos,6);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null},t.prototype.geometryType=function(){var t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readUint8(this.bb_pos+t):n.Unknown},t.prototype.hasZ=function(){var t=this.bb.__offset(this.bb_pos,10);return!!t&&!!this.bb.readInt8(this.bb_pos+t)},t.prototype.hasM=function(){var t=this.bb.__offset(this.bb_pos,12);return!!t&&!!this.bb.readInt8(this.bb_pos+t)},t.prototype.hasT=function(){var t=this.bb.__offset(this.bb_pos,14);return!!t&&!!this.bb.readInt8(this.bb_pos+t)},t.prototype.hasTM=function(){var t=this.bb.__offset(this.bb_pos,16);return!!t&&!!this.bb.readInt8(this.bb_pos+t)},t.prototype.columns=function(t,e){var n=this.bb.__offset(this.bb_pos,18);return n?(e||new i).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+4*t),this.bb):null},t.prototype.columnsLength=function(){var t=this.bb.__offset(this.bb_pos,18);return t?this.bb.__vector_len(this.bb_pos+t):0},t.prototype.featuresCount=function(){var t=this.bb.__offset(this.bb_pos,20);return t?this.bb.readUint64(this.bb_pos+t):this.bb.createLong(0,0)},t.prototype.indexNodeSize=function(){var t=this.bb.__offset(this.bb_pos,22);return t?this.bb.readUint16(this.bb_pos+t):16},t.prototype.crs=function(t){var e=this.bb.__offset(this.bb_pos,24);return e?(t||new o).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null},t.prototype.title=function(t){var e=this.bb.__offset(this.bb_pos,26);return e?this.bb.__string(this.bb_pos+e,t):null},t.prototype.description=function(t){var e=this.bb.__offset(this.bb_pos,28);return e?this.bb.__string(this.bb_pos+e,t):null},t.prototype.metadata=function(t){var e=this.bb.__offset(this.bb_pos,30);return e?this.bb.__string(this.bb_pos+e,t):null},t.start=function(t){t.startObject(14)},t.addName=function(t,e){t.addFieldOffset(0,e,0)},t.addEnvelope=function(t,e){t.addFieldOffset(1,e,0)},t.createEnvelopeVector=function(t,e){t.startVector(8,e.length,8);for(var n=e.length-1;n>=0;n--)t.addFloat64(e[n]);return t.endVector()},t.startEnvelopeVector=function(t,e){t.startVector(8,e,8)},t.addGeometryType=function(t,e){t.addFieldInt8(2,e,n.Unknown)},t.addHasZ=function(t,e){t.addFieldInt8(3,+e,0)},t.addHasM=function(t,e){t.addFieldInt8(4,+e,0)},t.addHasT=function(t,e){t.addFieldInt8(5,+e,0)},t.addHasTM=function(t,e){t.addFieldInt8(6,+e,0)},t.addColumns=function(t,e){t.addFieldOffset(7,e,0)},t.createColumnsVector=function(t,e){t.startVector(4,e.length,4);for(var n=e.length-1;n>=0;n--)t.addOffset(e[n]);return t.endVector()},t.startColumnsVector=function(t,e){t.startVector(4,e,4)},t.addFeaturesCount=function(t,e){t.addFieldInt64(8,e,t.createLong(0,0))},t.addIndexNodeSize=function(t,e){t.addFieldInt16(9,e,16)},t.addCrs=function(t,e){t.addFieldOffset(10,e,0)},t.addTitle=function(t,e){t.addFieldOffset(11,e,0)},t.addDescription=function(t,e){t.addFieldOffset(12,e,0)},t.addMetadata=function(t,e){t.addFieldOffset(13,e,0)},t.end=function(t){return t.endObject()},t.create=function(e,n,r,i,o,s,a,u,f,d,b,l,c,h,p){return t.start(e),t.addName(e,n),t.addEnvelope(e,r),t.addGeometryType(e,i),t.addHasZ(e,o),t.addHasM(e,s),t.addHasT(e,a),t.addHasTM(e,u),t.addColumns(e,f),t.addFeaturesCount(e,d),t.addIndexNodeSize(e,b),t.addCrs(e,l),t.addTitle(e,c),t.addDescription(e,h),t.addMetadata(e,p),t.end(e)},t}();e.Header=a;var u=function(){function t(){this.bb=null,this.bb_pos=0}return t.prototype.__init=function(t,e){return this.bb_pos=t,this.bb=e,this},t.getRoot=function(e,n){return(n||new t).__init(e.readInt32(e.position())+e.position(),e)},t.getSizePrefixedRoot=function(e,n){return e.setPosition(e.position()+s.flatbuffers.SIZE_PREFIX_LENGTH),(n||new t).__init(e.readInt32(e.position())+e.position(),e)},t.prototype.ends=function(t){var e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readUint32(this.bb.__vector(this.bb_pos+e)+4*t):0},t.prototype.endsLength=function(){var t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0},t.prototype.endsArray=function(){var t=this.bb.__offset(this.bb_pos,4);return t?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null},t.prototype.xy=function(t){var e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readFloat64(this.bb.__vector(this.bb_pos+e)+8*t):0},t.prototype.xyLength=function(){var t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0},t.prototype.xyArray=function(){var t=this.bb.__offset(this.bb_pos,6);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null},t.prototype.z=function(t){var e=this.bb.__offset(this.bb_pos,8);return e?this.bb.readFloat64(this.bb.__vector(this.bb_pos+e)+8*t):0},t.prototype.zLength=function(){var t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0},t.prototype.zArray=function(){var t=this.bb.__offset(this.bb_pos,8);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null},t.prototype.m=function(t){var e=this.bb.__offset(this.bb_pos,10);return e?this.bb.readFloat64(this.bb.__vector(this.bb_pos+e)+8*t):0},t.prototype.mLength=function(){var t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__vector_len(this.bb_pos+t):0},t.prototype.mArray=function(){var t=this.bb.__offset(this.bb_pos,10);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null},t.prototype.t=function(t){var e=this.bb.__offset(this.bb_pos,12);return e?this.bb.readFloat64(this.bb.__vector(this.bb_pos+e)+8*t):0},t.prototype.tLength=function(){var t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__vector_len(this.bb_pos+t):0},t.prototype.tArray=function(){var t=this.bb.__offset(this.bb_pos,12);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null},t.prototype.tm=function(t){var e=this.bb.__offset(this.bb_pos,14);return e?this.bb.readUint64(this.bb.__vector(this.bb_pos+e)+8*t):this.bb.createLong(0,0)},t.prototype.tmLength=function(){var t=this.bb.__offset(this.bb_pos,14);return t?this.bb.__vector_len(this.bb_pos+t):0},t.prototype.type=function(){var t=this.bb.__offset(this.bb_pos,16);return t?this.bb.readUint8(this.bb_pos+t):n.Unknown},t.prototype.parts=function(e,n){var r=this.bb.__offset(this.bb_pos,18);return r?(n||new t).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+4*e),this.bb):null},t.prototype.partsLength=function(){var t=this.bb.__offset(this.bb_pos,18);return t?this.bb.__vector_len(this.bb_pos+t):0},t.start=function(t){t.startObject(8)},t.addEnds=function(t,e){t.addFieldOffset(0,e,0)},t.createEndsVector=function(t,e){t.startVector(4,e.length,4);for(var n=e.length-1;n>=0;n--)t.addInt32(e[n]);return t.endVector()},t.startEndsVector=function(t,e){t.startVector(4,e,4)},t.addXy=function(t,e){t.addFieldOffset(1,e,0)},t.createXyVector=function(t,e){t.startVector(8,e.length,8);for(var n=e.length-1;n>=0;n--)t.addFloat64(e[n]);return t.endVector()},t.startXyVector=function(t,e){t.startVector(8,e,8)},t.addZ=function(t,e){t.addFieldOffset(2,e,0)},t.createZVector=function(t,e){t.startVector(8,e.length,8);for(var n=e.length-1;n>=0;n--)t.addFloat64(e[n]);return t.endVector()},t.startZVector=function(t,e){t.startVector(8,e,8)},t.addM=function(t,e){t.addFieldOffset(3,e,0)},t.createMVector=function(t,e){t.startVector(8,e.length,8);for(var n=e.length-1;n>=0;n--)t.addFloat64(e[n]);return t.endVector()},t.startMVector=function(t,e){t.startVector(8,e,8)},t.addT=function(t,e){t.addFieldOffset(4,e,0)},t.createTVector=function(t,e){t.startVector(8,e.length,8);for(var n=e.length-1;n>=0;n--)t.addFloat64(e[n]);return t.endVector()},t.startTVector=function(t,e){t.startVector(8,e,8)},t.addTm=function(t,e){t.addFieldOffset(5,e,0)},t.createTmVector=function(t,e){t.startVector(8,e.length,8);for(var n=e.length-1;n>=0;n--)t.addInt64(e[n]);return t.endVector()},t.startTmVector=function(t,e){t.startVector(8,e,8)},t.addType=function(t,e){t.addFieldInt8(6,e,n.Unknown)},t.addParts=function(t,e){t.addFieldOffset(7,e,0)},t.createPartsVector=function(t,e){t.startVector(4,e.length,4);for(var n=e.length-1;n>=0;n--)t.addOffset(e[n]);return t.endVector()},t.startPartsVector=function(t,e){t.startVector(4,e,4)},t.end=function(t){return t.endObject()},t.create=function(e,n,r,i,o,s,a,u,f){return t.start(e),t.addEnds(e,n),t.addXy(e,r),t.addZ(e,i),t.addM(e,o),t.addT(e,s),t.addTm(e,a),t.addType(e,u),t.addParts(e,f),t.end(e)},t}();e.Geometry=u;var f=function(){function t(){this.bb=null,this.bb_pos=0}return t.prototype.__init=function(t,e){return this.bb_pos=t,this.bb=e,this},t.getRoot=function(e,n){return(n||new t).__init(e.readInt32(e.position())+e.position(),e)},t.getSizePrefixedRoot=function(e,n){return e.setPosition(e.position()+s.flatbuffers.SIZE_PREFIX_LENGTH),(n||new t).__init(e.readInt32(e.position())+e.position(),e)},t.prototype.geometry=function(t){var e=this.bb.__offset(this.bb_pos,4);return e?(t||new u).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null},t.prototype.properties=function(t){var e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readUint8(this.bb.__vector(this.bb_pos+e)+t):0},t.prototype.propertiesLength=function(){var t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0},t.prototype.propertiesArray=function(){var t=this.bb.__offset(this.bb_pos,6);return t?new Uint8Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null},t.prototype.columns=function(t,e){var n=this.bb.__offset(this.bb_pos,8);return n?(e||new i).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+4*t),this.bb):null},t.prototype.columnsLength=function(){var t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0},t.start=function(t){t.startObject(3)},t.addGeometry=function(t,e){t.addFieldOffset(0,e,0)},t.addProperties=function(t,e){t.addFieldOffset(1,e,0)},t.createPropertiesVector=function(t,e){t.startVector(1,e.length,1);for(var n=e.length-1;n>=0;n--)t.addInt8(e[n]);return t.endVector()},t.startPropertiesVector=function(t,e){t.startVector(1,e,1)},t.addColumns=function(t,e){t.addFieldOffset(2,e,0)},t.createColumnsVector=function(t,e){t.startVector(4,e.length,4);for(var n=e.length-1;n>=0;n--)t.addOffset(e[n]);return t.endVector()},t.startColumnsVector=function(t,e){t.startVector(4,e,4)},t.end=function(t){return t.endObject()},t.finishBuffer=function(t,e){t.finish(e)},t.finishSizePrefixedBuffer=function(t,e){t.finish(e,void 0,!0)},t.create=function(e,n,r,i){return t.start(e),t.addGeometry(e,n),t.addProperties(e,r),t.addColumns(e,i),t.end(e)},t}();e.Feature=f});e(d);d.Feature,d.Geometry,d.Header,d.Crs,d.Column,d.ColumnType,d.GeometryType;var b=n(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.toGeometryType=e.pairFlatCoordinates=e.parseGeometry=e.flat=e.buildGeometry=void 0,e.buildGeometry=function t(e,n){var r=n.xy,i=n.z,o=n.ends,s=n.parts,a=n.type;if(s){var u=s.map(function(n){return t(e,n)}),f=d.Geometry.createPartsVector(e,u);return d.Geometry.start(e),d.Geometry.addParts(e,f),d.Geometry.end(e)}var b,l,c=d.Geometry.createXyVector(e,r);return i&&(b=d.Geometry.createZVector(e,i)),o&&(l=d.Geometry.createEndsVector(e,o)),d.Geometry.start(e),l&&d.Geometry.addEnds(e,l),d.Geometry.addXy(e,c),b&&d.Geometry.addZ(e,b),d.Geometry.addType(e,a),d.Geometry.end(e)},e.flat=function t(e,n,r){if(0!==e.length)if(Array.isArray(e[0]))for(var i=0,o=e;i<o.length;i++)t(o[i],n,r);else 2===e.length?n.push.apply(n,e):(n.push(e[0],e[1]),r.push(e[2]))},e.parseGeometry=function t(e,n){var r,i,o;if(n===a.GeometryType.MultiLineString){e.getFlatCoordinates&&(r=e.getFlatCoordinates());var s=e.getEnds();s.length>1&&(i=s.map(function(t){return t>>1}))}else if(n===a.GeometryType.Polygon){e.getFlatCoordinates&&(r=e.getFlatCoordinates());var u=e.getEnds();u.length>1&&(i=u.map(function(t){return t>>1}))}else n===a.GeometryType.MultiPolygon?o=e.getPolygons().map(function(e){return t(e,a.GeometryType.Polygon)}):e.getFlatCoordinates&&(r=e.getFlatCoordinates());return{xy:r,ends:i,type:n,parts:o}},e.pairFlatCoordinates=function(t,e){for(var n=[],r=0;r<t.length;r+=2){var i=[t[r],t[r+1]];e&&i.push(e[r>>1]),n.push(i)}return n},e.toGeometryType=function(t){return t?a.GeometryType[t]:a.GeometryType.Unknown}});e(b);b.toGeometryType,b.pairFlatCoordinates,b.parseGeometry,b.flat,b.buildGeometry;var l=n(function(t,e){function n(t,e,n){if(!n||0===n.length)return[b.pairFlatCoordinates(t,e)];var r,i=0,o=Array.from(n).map(function(e){return t.slice(i,i=e<<1)});return e&&(i=0,r=Array.from(n).map(function(t){return e.slice(i,i=t)})),o.map(function(t,e){return b.pairFlatCoordinates(t,r?r[e]:void 0)})}function r(t,e){var r=t.xyArray(),i=t.zArray();switch(e){case a.GeometryType.Point:var o=Array.from(r);return i&&o.push(i[0]),o;case a.GeometryType.MultiPoint:case a.GeometryType.LineString:return b.pairFlatCoordinates(r,i);case a.GeometryType.MultiLineString:case a.GeometryType.Polygon:return n(r,i,t.endsArray())}}Object.defineProperty(e,"__esModule",{value:!0}),e.fromGeometry=e.parseGeometry=void 0,e.parseGeometry=function t(e){var n,r,i=e.coordinates,o=[],s=[],a=b.toGeometryType(e.type),u=0;switch(e.type){case"Point":b.flat(i,o,s);break;case"MultiPoint":case"LineString":b.flat(i,o,s);break;case"MultiLineString":case"Polygon":var f=i;b.flat(f,o,s),f.length>1&&(n=f.map(function(t){return u+=t.length}));break;case"MultiPolygon":r=i.map(function(t){return{type:"Polygon",coordinates:t}}).map(t);break;case"GeometryCollection":e.geometries&&(r=e.geometries.map(t))}return{xy:o,z:s.length>0?s:void 0,ends:n,type:a,parts:r}},e.fromGeometry=function t(e,n){if(n===a.GeometryType.GeometryCollection){for(var i=[],o=0;o<e.partsLength();o++){var s=e.parts(o),u=s.type();i.push(t(s,u))}return{type:a.GeometryType[n],geometries:i}}if(n===a.GeometryType.MultiPolygon){for(i=[],o=0;o<e.partsLength();o++)i.push(t(e.parts(o),a.GeometryType.Polygon));return{type:a.GeometryType[n],coordinates:i.map(function(t){return t.coordinates})}}var f=r(e,n);return{type:a.GeometryType[n],coordinates:f}}});e(l);l.fromGeometry,l.parseGeometry;var c=n(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.parseProperties=e.buildFeature=e.fromFeature=void 0;var n=new TextEncoder,r=new TextDecoder;function i(t,e){var n={};if(!e||0===e.length)return n;var i=t.propertiesArray();if(!i)return n;for(var o=new DataView(i.buffer,i.byteOffset),s=t.propertiesLength(),u=0;u<s;){var f=o.getUint16(u,!0);u+=2;var d=e[f],b=d.name;switch(d.type){case a.ColumnType.Bool:n[b]=!!o.getUint8(u),u+=1;break;case a.ColumnType.Byte:n[b]=o.getInt8(u),u+=1;break;case a.ColumnType.UByte:n[b]=o.getUint8(u),u+=1;break;case a.ColumnType.Short:n[b]=o.getInt16(u,!0),u+=2;break;case a.ColumnType.UShort:n[b]=o.getUint16(u,!0),u+=2;break;case a.ColumnType.Int:n[b]=o.getInt32(u,!0),u+=4;break;case a.ColumnType.UInt:n[b]=o.getUint32(u,!0),u+=4;break;case a.ColumnType.Long:n[b]=Number(o.getBigInt64(u,!0)),u+=8;break;case a.ColumnType.ULong:n[b]=Number(o.getBigUint64(u,!0)),u+=8;break;case a.ColumnType.Double:n[b]=o.getFloat64(u,!0),u+=8;break;case a.ColumnType.DateTime:case a.ColumnType.String:var l=o.getUint32(u,!0);u+=4,n[b]=r.decode(i.subarray(u,u+l)),u+=l;break;default:throw new Error("Unknown type "+d.type)}}return n}e.fromFeature=function(t,e,n,r){var o=e.columns;return r(n(t.geometry(),e.geometryType),i(t,o))},e.buildFeature=function(t,e,r){var i=r.columns,o=new s.flatbuffers.Builder,u=0,f=1024,l=new Uint8Array(f),c=new DataView(l.buffer),h=function(t){if(!(u+t<f)){f*=2;var e=new Uint8Array(f);e.set(l),l=e,c=new DataView(l.buffer,u)}};if(i)for(var p=0;p<i.length;p++){var _=i[p],y=e[_.name];if(null!==y)switch(c.setUint16(u,p,!0),u+=2,_.type){case a.ColumnType.Bool:h(1),c.setUint8(u,y),u+=1;break;case a.ColumnType.Short:h(2),c.setInt16(u,y,!0),u+=2;break;case a.ColumnType.UShort:h(2),c.setUint16(u,y,!0),u+=2;break;case a.ColumnType.Int:h(4),c.setInt32(u,y,!0),u+=4;break;case a.ColumnType.UInt:h(4),c.setUint32(u,y,!0),u+=4;break;case a.ColumnType.Long:h(8),c.setBigInt64(u,BigInt(y),!0),u+=8;break;case a.ColumnType.Double:h(8),c.setFloat64(u,y,!0),u+=8;break;case a.ColumnType.DateTime:case a.ColumnType.String:var v=n.encode(y);h(4),c.setUint32(u,v.length,!0),u+=4,h(v.length),l.set(v,u),u+=v.length;break;default:throw new Error("Unknown type "+_.type)}}var g=null;u>0&&(g=d.Feature.createPropertiesVector(o,l.slice(0,u)));var m=b.buildGeometry(o,t);d.Feature.start(o),d.Feature.addGeometry(o,m),g&&d.Feature.addProperties(o,g);var I=d.Feature.end(o);return o.finishSizePrefixed(I),o.asUint8Array()},e.parseProperties=i});e(c);c.parseProperties,c.buildFeature,c.fromFeature;var h=n(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.fromFeature=void 0,e.fromFeature=function(t,e){var n=e.columns,r={type:"Feature",geometry:l.fromGeometry(t.geometry(),e.geometryType)};return n&&n.length>0&&(r.properties=c.parseProperties(t,n)),r}});e(h);h.fromFeature;var p=new Uint8Array(0);function _(t,e){if(!t.length)return e;if(!e.length)return t;var n=new Uint8Array(t.length+e.length);return n.set(t),n.set(e,t.length),n}function y(t){this._source=t,this._array=p,this._index=0}y.prototype.read=function(){var t=this,e=t._array.subarray(t._index);return t._source.read().then(function(n){return t._array=p,t._index=0,n.done?e.length>0?{done:!1,value:e}:{done:!0,value:void 0}:{done:!1,value:_(e,n.value)}})},y.prototype.slice=function(t){if((t|=0)<0)throw new Error("invalid length");var e=this,n=this._array.length-this._index;if(this._index+t<=this._array.length)return Promise.resolve(this._array.subarray(this._index,this._index+=t));var r=new Uint8Array(t);return r.set(this._array.subarray(this._index)),function i(){return e._source.read().then(function(o){return o.done?(e._array=p,e._index=0,n>0?r.subarray(0,n):null):n+o.value.length>=t?(e._array=o.value,e._index=t-n,r.set(o.value.subarray(0,t-n),n),r):(r.set(o.value,n),n+=o.value.length,i())})}()},y.prototype.cancel=function(){return this._source.cancel()};var v=Object.freeze({__proto__:null,default:function(t){return"function"==typeof t.slice?t:new y("function"==typeof t.read?t:t.getReader())}}),g=n(function(e,n){var r,i=t&&t.__spreadArray||function(t,e){for(var n=0,r=e.length,i=t.length;n<r;n++,i++)t[i]=e[n];return t};Object.defineProperty(n,"__esModule",{value:!0}),n.LogLevel=void 0,function(t){t[t.Debug=0]="Debug",t[t.Info=1]="Info",t[t.Warn=2]="Warn",t[t.Error=3]="Error"}(r=n.LogLevel||(n.LogLevel={}));var o=function(){function t(){}return t.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.log.apply(this,i([r.Debug],t))},t.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.log.apply(this,i([r.Info],t))},t.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.log.apply(this,i([r.Warn],t))},t.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.log.apply(this,i([r.Error],t))},t.log=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(!(this.logLevel>t))switch(t){case r.Debug:console.debug.apply(console,e);break;case r.Info:console.info.apply(console,e);break;case r.Warn:console.warn.apply(console,e);break;case r.Error:console.error.apply(console,e)}},t.logLevel=r.Info,t}();n.default=o});e(g);g.LogLevel;var m=n(function(e,n){var r=t&&t.__generator||function(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},i=t&&t.__await||function(t){return this instanceof i?(this.v=t,this):new i(t)},o=t&&t.__asyncGenerator||function(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,o=n.apply(t,e||[]),s=[];return r={},a("next"),a("throw"),a("return"),r[Symbol.asyncIterator]=function(){return this},r;function a(t){o[t]&&(r[t]=function(e){return new Promise(function(n,r){s.push([t,e,n,r])>1||u(t,e)})})}function u(t,e){try{(n=o[t](e)).value instanceof i?Promise.resolve(n.value.v).then(f,d):b(s[0][2],n)}catch(t){b(s[0][3],t)}var n}function f(t){u("next",t)}function d(t){u("throw",t)}function b(t,e){t(e),s.shift(),s.length&&u(s[0][0],s[0][1])}},s=t&&t.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(n,"__esModule",{value:!0}),n.streamSearch=n.calcTreeSize=n.DEFAULT_NODE_SIZE=n.NODE_ITEM_LEN=void 0;var a=s(g);n.NODE_ITEM_LEN=40,n.DEFAULT_NODE_SIZE=16,n.calcTreeSize=function(t,e){e=Math.min(Math.max(+e,2),65535);var r=t,i=r;do{i+=r=Math.ceil(r/e)}while(1!==r);return i*n.NODE_ITEM_LEN},n.streamSearch=function(t,e,s,u){return o(this,arguments,function(){var o,f,d,b,l,c,h,p,_,y;return r(this,function(v){switch(v.label){case 0:o=function(){function t(t,e){this._level=e,this.nodes=t}return t.prototype.level=function(){return this._level},t.prototype.startNode=function(){return this.nodes[0]},t.prototype.endNode=function(){return this.nodes[1]},t.prototype.extendEndNodeToNewOffset=function(t){console.assert(t>this.nodes[1]),this.nodes[1]=t},t.prototype.toString=function(){return"[NodeRange level: "+this._level+", nodes: "+this.nodes[0]+"-"+this.nodes[1]+"]"},t}(),f=s.minX,d=s.minY,b=s.maxX,l=s.maxY,c=function(t,e){if(e<2)throw new Error("Node size must be at least 2");if(0===t)throw new Error("Number of items must be greater than 0");var n=t,r=n,i=[n];do{r+=n=Math.ceil(n/e),i.push(n)}while(1!==n);var o=[];n=r;for(var s=0,a=i;s<a.length;s++){var u=a[s];o.push(n-u),n-=u}o.reverse(),i.reverse();for(var f=[],d=0;d<i.length;d++)f.push([o[d],o[d]+i[d]]);return f.reverse(),f}(t,e),h=c[0][0],g=c.length-1,p=new o([0,1],g),_=[p],a.default.debug("starting stream search with queue: "+_+", numItems: "+t+", nodeSize: "+e+", levelBounds: "+c),y=function(){var t,s,p,y,v,g,m,I,w,F,T,E;return r(this,function(B){switch(B.label){case 0:return t=_.shift(),a.default.debug("popped node: "+t+", queueLength: "+_.length),s=t.startNode(),p=s>=h,y=c[t.level()],v=y[1],g=Math.min(t.endNode()+e,v),m=g-s,[4,i(u(s*n.NODE_ITEM_LEN,m*n.NODE_ITEM_LEN))];case 1:I=B.sent(),w=new Float64Array(I),F=new Uint32Array(I),T=function(e){var u,c,y,v,g,m,I;return r(this,function(r){switch(r.label){case 0:return b<w[0+(u=5*(e-s))]?[2,"continue"]:l<w[u+1]?[2,"continue"]:f>w[u+2]?[2,"continue"]:d>w[u+3]?[2,"continue"]:(c=F[8+(u<<1)],y=F[9+(u<<1)],v=function(t,e){if(0!=(4293918720&t))throw Error("integer is too large to be safely represented");return e+t*Math.pow(2,32)}(y,c),p?(a.default.debug("yielding feature"),[4,i([v,e-h])]):[3,3]);case 1:return[4,r.sent()];case 2:return r.sent(),[2,"continue"];case 3:return g=262144/n.NODE_ITEM_LEN,void 0!==(m=_[_.length-1])&&m.level()==t.level()-1&&v<m.endNode()+g?(a.default.debug("Extending existing node: "+m+", newOffset: "+m.endNode()+" -> "+v),m.extendEndNodeToNewOffset(v),[2,"continue"]):(T=t.level()-1,I=new o([v,v+1],T),void 0!==m&&m.level()==t.level()-1?a.default.debug("pushing new node at offset: "+v+" rather than merging with distant "+m):a.default.debug("pushing new level for "+I+" onto queue with tail: "+m),_.push(I),[2])}var T})},E=s,B.label=2;case 2:return E<g?[5,T(E)]:[3,5];case 3:B.sent(),B.label=4;case 4:return E++,[3,2];case 5:return[2]}})},v.label=1;case 1:return 0==_.length?[3,3]:[5,y()];case 2:return v.sent(),[3,1];case 3:return[2]}var g})})}});e(m);m.streamSearch,m.calcTreeSize,m.DEFAULT_NODE_SIZE,m.NODE_ITEM_LEN;var I=n(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.SIZE_PREFIX_LEN=e.magicbytes=void 0,e.magicbytes=new Uint8Array([102,103,98,3,102,103,98,0]),e.SIZE_PREFIX_LEN=4});e(I);I.SIZE_PREFIX_LEN,I.magicbytes;var w=n(function(e,n){var r=t&&t.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function s(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(s,a)}u((r=r.apply(t,e||[])).next())})},i=t&&t.__generator||function(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},o=t&&t.__asyncValues||function(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,n=t[Symbol.asyncIterator];return n?n.call(t):(t="function"==typeof l?l(t):t[Symbol.iterator](),e={},r("next"),r("throw"),r("return"),e[Symbol.asyncIterator]=function(){return this},e);function r(n){e[n]=t[n]&&function(e){return new Promise(function(r,i){(function(t,e,n,r){Promise.resolve(r).then(function(e){t({value:e,done:n})},e)})(r,i,(e=t[n](e)).done,e.value)})}}},a=t&&t.__await||function(t){return this instanceof a?(this.v=t,this):new a(t)},u=t&&t.__asyncDelegator||function(t){var e,n;return e={},r("next"),r("throw",function(t){throw t}),r("return"),e[Symbol.iterator]=function(){return this},e;function r(r,i){e[r]=t[r]?function(e){return(n=!n)?{value:a(t[r](e)),done:"return"===r}:i?i(e):e}:i}},b=t&&t.__asyncGenerator||function(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(t,e||[]),o=[];return r={},s("next"),s("throw"),s("return"),r[Symbol.asyncIterator]=function(){return this},r;function s(t){i[t]&&(r[t]=function(e){return new Promise(function(n,r){o.push([t,e,n,r])>1||u(t,e)})})}function u(t,e){try{(n=i[t](e)).value instanceof a?Promise.resolve(n.value.v).then(f,d):b(o[0][2],n)}catch(t){b(o[0][3],t)}var n}function f(t){u("next",t)}function d(t){u("throw",t)}function b(t,e){t(e),o.shift(),o.length&&u(o[0][0],o[0][1])}},l=t&&t.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},c=t&&t.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(n,"__esModule",{value:!0}),n.HttpReader=void 0;var h=c(g),p=c(f),_=function(){function t(t,e,n,r){this.headerClient=t,this.header=e,this.headerLength=n,this.indexLength=r}return t.open=function(e){return r(this,void 0,void 0,function(){var n,r,o,a,u,f,d,b,l,c,_;return i(this,function(i){switch(i.label){case 0:return 2024,n=new y(e),r=function(){var t,e=m.DEFAULT_NODE_SIZE,n=0;for(t=0;t<3;t++){n+=Math.pow(e,t)*m.NODE_ITEM_LEN}return n}(),o=2024+r,h.default.debug("fetching header. minReqLength: "+o+" (assumedHeaderLength: 2024, assumedIndexLength: "+r+")"),u=Uint8Array.bind,[4,n.getRange(0,8,o,"header")];case 1:if(!(a=new(u.apply(Uint8Array,[void 0,i.sent()]))).every(function(t,e){return I.magicbytes[e]===t}))throw h.default.error("bytes: "+a+" != "+I.magicbytes),new Error("Not a FlatGeobuf file");return h.default.debug("magic bytes look good"),[4,n.getRange(8,4,o,"header")];case 2:if(d=i.sent(),f=new DataView(d).getUint32(0,!0),10485760,f>10485760||f<8)throw new Error("Invalid header size");return h.default.debug("headerLength: "+f),[4,n.getRange(12,f,o,"header")];case 3:return b=i.sent(),l=new s.flatbuffers.ByteBuffer(new Uint8Array(b)),c=p.default.fromByteBuffer(l),_=m.calcTreeSize(c.featuresCount,c.indexNodeSize),h.default.debug("completed: opening http reader"),[2,new t(n,c,f,_)]}})})},t.prototype.selectBbox=function(t){return b(this,arguments,function(){var e,n,s;return i(this,function(f){switch(f.label){case 0:return e=this.lengthBeforeTree(),n=this.headerClient,s=function(t,o){return r(this,void 0,void 0,function(){return i(this,function(r){return 0,[2,n.getRange(e+t,o,0,"index")]})})},h.default.debug("starting: selectBbox, traversing index. lengthBeforeTree: "+e),[5,l(u(o(m.streamSearch(this.header.featuresCount,this.header.indexNodeSize,t,s))))];case 1:return[4,a.apply(void 0,[f.sent()])];case 2:return f.sent(),[2]}})})},t.prototype.lengthBeforeTree=function(){return I.magicbytes.length+I.SIZE_PREFIX_LEN+this.headerLength},t.prototype.lengthBeforeFeatures=function(){return this.lengthBeforeTree()+this.indexLength},t.prototype.featureClient=function(){return void 0===this._featureClient&&(this._featureClient=this.headerClient.clone()),this._featureClient},t.prototype.readFeature=function(t){return r(this,void 0,void 0,function(){var e,n,r,o,a,u,f,b;return i(this,function(i){switch(i.label){case 0:return e=131072,n=t+this.lengthBeforeFeatures(),[4,this.featureClient().getRange(n,4,e,"feature length")];case 1:return o=i.sent(),r=new DataView(o).getUint32(0,!0),h.default.debug("featureOffset: "+n+", featureLength: "+r),[4,this.featureClient().getRange(n+4,r,e,"feature data")];case 2:return a=i.sent(),u=new Uint8Array(a),(f=new Uint8Array(r+I.SIZE_PREFIX_LEN)).set(u,I.SIZE_PREFIX_LEN),(b=new s.flatbuffers.ByteBuffer(f)).setPosition(I.SIZE_PREFIX_LEN),[2,d.Feature.getRoot(b)]}})})},t}();n.HttpReader=_;var y=function(){function t(t){this.buffer=new ArrayBuffer(0),this.head=0,this.httpClient="string"==typeof t?new v(t):t}return t.prototype.clone=function(){var e=new t(this.httpClient);return e.buffer=this.buffer.slice(0),e.head=this.head,e},t.prototype.getRange=function(t,e,n,o){return r(this,void 0,void 0,function(){var r,s,a,u;return i(this,function(i){switch(i.label){case 0:return h.default.debug("need Range: "+t+"-"+(t+e-1)),r=t-this.head,s=r+e,r>=0&&s<this.buffer.byteLength?(h.default.debug("slicing existing Range: "+r+"-"+(s-1)),[2,this.buffer.slice(r,s)]):(a=Math.max(e,n),u=this,[4,this.httpClient.getRange(t,a,o)]);case 1:return u.buffer=i.sent(),this.head=t,[2,this.buffer.slice(0,e)]}})})},t}(),v=function(){function t(t){this.requestsEverMade=0,this.bytesEverRequested=0,this.url=t}return t.prototype.getRange=function(t,e,n){return r(this,void 0,void 0,function(){var r;return i(this,function(i){switch(i.label){case 0:return this.requestsEverMade+=1,this.bytesEverRequested+=e,r="bytes="+t+"-"+(t+e-1),h.default.debug("request: #"+this.requestsEverMade+", purpose: "+n+"), bytes: (this_request: "+e+", ever: "+this.bytesEverRequested+"), Range: "+r),[4,fetch(this.url,{headers:{Range:r}})];case 1:return[2,i.sent().arrayBuffer()]}})})},t}()});e(w);w.HttpReader;var F=r(v),T=n(function(e,n){var r=t&&t.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function s(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(s,a)}u((r=r.apply(t,e||[])).next())})},o=t&&t.__generator||function(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},u=t&&t.__await||function(t){return this instanceof u?(this.v=t,this):new u(t)},l=t&&t.__asyncGenerator||function(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(t,e||[]),o=[];return r={},s("next"),s("throw"),s("return"),r[Symbol.asyncIterator]=function(){return this},r;function s(t){i[t]&&(r[t]=function(e){return new Promise(function(n,r){o.push([t,e,n,r])>1||a(t,e)})})}function a(t,e){try{(n=i[t](e)).value instanceof u?Promise.resolve(n.value.v).then(f,d):b(o[0][2],n)}catch(t){b(o[0][3],t)}var n}function f(t){a("next",t)}function d(t){a("throw",t)}function b(t,e){t(e),o.shift(),o.length&&a(o[0][0],o[0][1])}},h=t&&t.__asyncValues||function(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,n=t[Symbol.asyncIterator];return n?n.call(t):(t="function"==typeof __values?__values(t):t[Symbol.iterator](),e={},r("next"),r("throw"),r("return"),e[Symbol.asyncIterator]=function(){return this},e);function r(n){e[n]=t[n]&&function(e){return new Promise(function(r,i){(function(t,e,n,r){Promise.resolve(r).then(function(e){t({value:e,done:n})},e)})(r,i,(e=t[n](e)).done,e.value)})}}},p=t&&t.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(n,"__esModule",{value:!0}),n.buildHeader=n.deserializeFiltered=n.deserializeStream=n.deserialize=n.serialize=void 0;var _=p(F),y=p(i),v=p(f),T=p(g),E=b;function B(t,e,n){return r(this,void 0,void 0,function(){var r,i,a,u,f,b,l;return o(this,function(o){switch(o.label){case 0:return i=Uint8Array.bind,[4,t(4,"feature length")];case 1:return 0===(r=new(i.apply(Uint8Array,[void 0,o.sent()]))).byteLength?[2]:(a=new s.flatbuffers.ByteBuffer(r),u=a.readUint32(0),f=Uint8Array.bind,[4,t(u,"feature data")]);case 2:return r=new(f.apply(Uint8Array,[void 0,o.sent()])),(b=new Uint8Array(u+4)).set(r,4),(a=new s.flatbuffers.ByteBuffer(b)).setPosition(I.SIZE_PREFIX_LEN),l=d.Feature.getRoot(a),[2,n(l,e)]}})})}function S(t){var e=new s.flatbuffers.Builder,n=null;t.columns&&(n=a.Header.createColumnsVector(e,t.columns.map(function(t){return function(t,e){var n=t.createString(e.name);return a.Column.start(t),a.Column.addName(t,n),a.Column.addType(t,e.type),a.Column.end(t)}(e,t)})));var r=e.createString("L1");a.Header.start(e),a.Header.addFeaturesCount(e,new s.flatbuffers.Long(t.featuresCount,0)),a.Header.addGeometryType(e,t.geometryType),a.Header.addIndexNodeSize(e,0),n&&a.Header.addColumns(e,n),a.Header.addName(e,r);var i=a.Header.end(e);return e.finishSizePrefixed(i),e.asUint8Array()}n.serialize=function(t){var e=function(t){var e=t[0],n=e.getGeometry?e.getGeometry():void 0,r=n?n.getType():void 0,i=e.getProperties?e.getProperties():{},o=null;return i&&(o=Object.keys(i).filter(function(t){return"geometry"!==t}).map(function(t){return new y.default(t,function(t){if("boolean"==typeof t)return a.ColumnType.Bool;if("number"==typeof t)return t%1==0?a.ColumnType.Int:a.ColumnType.Double;if("string"==typeof t)return a.ColumnType.String;if(null===t)return a.ColumnType.String;throw new Error("Unknown type (value '"+t+"')")}(i[t]),null,null,-1,-1,-1,!0,!1,!1)})),new v.default(b.toGeometryType(r),o,t.length,0,null,null,null,null)}(t),n=S(e),r=t.map(function(t){if(!t.getGeometry)throw new Error("Missing getGeometry implementation");if(!t.getProperties)throw new Error("Missing getProperties implementation");return c.buildFeature(E.parseGeometry(t.getGeometry(),e.geometryType),t.getProperties(),e)}),i=r.map(function(t){return t.length}).reduce(function(t,e){return t+e}),o=new Uint8Array(I.magicbytes.length+n.length+i);o.set(n,I.magicbytes.length);for(var s=I.magicbytes.length+n.length,u=0,f=r;u<f.length;u++){var d=f[u];o.set(d,s),s+=d.length}return o.set(I.magicbytes),o},n.deserialize=function(t,e,n){if(!t.subarray(0,7).every(function(t,e){return I.magicbytes[e]===t}))throw new Error("Not a FlatGeobuf file");var r=new s.flatbuffers.ByteBuffer(t),i=r.readUint32(I.magicbytes.length);r.setPosition(I.magicbytes.length+I.SIZE_PREFIX_LEN);var o=v.default.fromByteBuffer(r);n&&n(o);var a=I.magicbytes.length+I.SIZE_PREFIX_LEN+i,u=o.indexNodeSize,f=o.featuresCount;u>0&&(a+=m.calcTreeSize(f,u));for(var b=[];a<r.capacity();){var l=r.readUint32(a);r.setPosition(a+I.SIZE_PREFIX_LEN);var c=d.Feature.getRoot(r);b.push(e(c,o)),a+=I.SIZE_PREFIX_LEN+l}return b},n.deserializeStream=function(t,e,n){return l(this,arguments,function(){var i,a,f,d,b,l,c,h,p,y,g,w,F,T=this;return o(this,function(E){switch(E.label){case 0:return i=_.default(t),a=function(t){return r(T,void 0,void 0,function(){return o(this,function(e){switch(e.label){case 0:return[4,i.slice(t)];case 1:return[2,e.sent()]}})})},d=Uint8Array.bind,[4,u(a(8,"magic bytes"))];case 1:if(!(f=new(d.apply(Uint8Array,[void 0,E.sent()]))).every(function(t,e){return I.magicbytes[e]===t}))throw new Error("Not a FlatGeobuf file");return b=Uint8Array.bind,[4,u(a(4,"header length"))];case 2:return f=new(b.apply(Uint8Array,[void 0,E.sent()])),l=new s.flatbuffers.ByteBuffer(f),c=l.readUint32(0),h=Uint8Array.bind,[4,u(a(c,"header data"))];case 3:return f=new(h.apply(Uint8Array,[void 0,E.sent()])),l=new s.flatbuffers.ByteBuffer(f),p=v.default.fromByteBuffer(l),n&&n(p),y=p.indexNodeSize,g=p.featuresCount,y>0?(w=m.calcTreeSize(g,y),[4,u(a(w,"entire index, w/o rect"))]):[3,5];case 4:E.sent(),E.label=5;case 5:return[4,u(B(a,p,e))];case 6:return(F=E.sent())?[4,u(F)]:[3,9];case 7:return[4,E.sent()];case 8:return E.sent(),[3,5];case 9:return[2]}})})},n.deserializeFiltered=function(t,e,n,r){return l(this,arguments,function(){var i,s,a,f,d,b,l,c;return o(this,function(o){switch(o.label){case 0:return[4,u(w.HttpReader.open(t))];case 1:i=o.sent(),T.default.debug("opened reader"),r&&r(i.header),o.label=2;case 2:o.trys.push([2,10,11,16]),s=h(i.selectBbox(e)),o.label=3;case 3:return[4,u(s.next())];case 4:return(a=o.sent()).done?[3,9]:(f=a.value,[4,u(i.readFeature(f[0]))]);case 5:return d=o.sent(),[4,u(n(d,i.header))];case 6:return[4,o.sent()];case 7:o.sent(),o.label=8;case 8:return[3,3];case 9:return[3,16];case 10:return b=o.sent(),l={error:b},[3,16];case 11:return o.trys.push([11,,14,15]),a&&!a.done&&(c=s.return)?[4,u(c.call(s))]:[3,13];case 12:o.sent(),o.label=13;case 13:return[3,15];case 14:if(l)throw l.error;return[7];case 15:return[7];case 16:return[2]}})})},n.buildHeader=S});e(T);T.buildHeader,T.deserializeFiltered,T.deserializeStream,T.deserialize,T.serialize;var E=n(function(e,n){var r=t&&t.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(n,"__esModule",{value:!0}),n.deserializeFiltered=n.deserializeStream=n.deserialize=n.serialize=void 0;var o=r(i),s=r(f);n.serialize=function(t){var e=function(t){var e=t.features[0],n=e.properties,r=null;return n&&(r=Object.keys(n).map(function(t){return new o.default(t,function(t){if("boolean"==typeof t)return a.ColumnType.Bool;if("number"==typeof t)return t%1==0?a.ColumnType.Int:a.ColumnType.Double;if("string"==typeof t)return a.ColumnType.String;if(null===t)return a.ColumnType.String;throw new Error("Unknown type (value '"+t+"')")}(n[t]),null,null,-1,-1,-1,!0,!1,!1)})),new s.default(b.toGeometryType(e.geometry.type),r,t.features.length,0,null,null,null,null)}(t),n=T.buildHeader(e),r=t.features.map(function(t){return c.buildFeature(l.parseGeometry(t.geometry),t.properties,e)}),i=r.map(function(t){return t.length}).reduce(function(t,e){return t+e}),u=new Uint8Array(I.magicbytes.length+n.length+i);u.set(n,I.magicbytes.length);for(var f=I.magicbytes.length+n.length,d=0,h=r;d<h.length;d++){var p=h[d];u.set(p,f),f+=p.length}return u.set(I.magicbytes),u},n.deserialize=function(t,e){return{type:"FeatureCollection",features:T.deserialize(t,h.fromFeature,e)}},n.deserializeStream=function(t,e){return T.deserializeStream(t,h.fromFeature,e)},n.deserializeFiltered=function(t,e,n){return T.deserializeFiltered(t,e,h.fromFeature,n)}});e(E);E.deserializeFiltered,E.deserializeStream,E.deserialize,E.serialize;var B=n(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.deserialize=e.serialize=void 0,e.serialize=function(t){return E.serialize(t)},e.deserialize=function(t,e,n){return t instanceof Uint8Array?E.deserialize(t,n):t instanceof ReadableStream?E.deserializeStream(t,n):E.deserializeFiltered(t,e,n)}});e(B);var S=B.deserialize,C=(B.serialize,Math.PI/180),O=180/Math.PI;function P(t){var e=L(t[0]+1,t[2]);return[L(t[0],t[2]),N(t[1]+1,t[2]),e,N(t[1],t[2])]}function L(t,e){return t/Math.pow(2,e)*360-180}function N(t,e){var n=Math.PI-2*Math.PI*t/Math.pow(2,e);return O*Math.atan(.5*(Math.exp(n)-Math.exp(-n)))}function U(t,e,n){var r=V(t,e,n);return r[0]=Math.floor(r[0]),r[1]=Math.floor(r[1]),r}function G(t){return[[2*t[0],2*t[1],t[2]+1],[2*t[0]+1,2*t[1],t[2]+1],[2*t[0]+1,2*t[1]+1,t[2]+1],[2*t[0],2*t[1]+1,t[2]+1]]}function M(t){return[t[0]>>1,t[1]>>1,t[2]-1]}function x(t){return G(M(t))}function R(t,e){for(var n=0;n<t.length;n++)if(z(t[n],e))return!0;return!1}function z(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function V(t,e,n){var r=Math.sin(e*C),i=Math.pow(2,n),o=i*(t/360+.5);return(o%=i)<0&&(o+=i),[o,i*(.5-.25*Math.log((1+r)/(1-r))/Math.PI),n]}var A={tileToGeoJSON:function(t){var e=P(t);return{type:"Polygon",coordinates:[[[e[0],e[3]],[e[0],e[1]],[e[2],e[1]],[e[2],e[3]],[e[0],e[3]]]]}},tileToBBOX:P,getChildren:G,getParent:M,getSiblings:x,hasTile:R,hasSiblings:function(t,e){for(var n=x(t),r=0;r<n.length;r++)if(!R(e,n[r]))return!1;return!0},tilesEqual:z,tileToQuadkey:function(t){for(var e="",n=t[2];n>0;n--){var r=0,i=1<<n-1;0!=(t[0]&i)&&r++,0!=(t[1]&i)&&(r+=2),e+=r.toString()}return e},quadkeyToTile:function(t){for(var e=0,n=0,r=t.length,i=r;i>0;i--){var o=1<<i-1,s=+t[r-i];1===s&&(e|=o),2===s&&(n|=o),3===s&&(e|=o,n|=o)}return[e,n,r]},pointToTile:U,bboxToTile:function(t){var e=U(t[0],t[1],32),n=U(t[2],t[3],32),r=[e[0],e[1],n[0],n[1]],i=function(t){for(var e=0;e<28;e++){var n=1<<32-(e+1);if((t[0]&n)!=(t[2]&n)||(t[1]&n)!=(t[3]&n))return e}return 28}(r);return 0===i?[0,0,0]:[r[0]>>>32-i,r[1]>>>32-i,i]},pointToTileFraction:V};return class{constructor(t,e,n,r){if(!t||!e||!n)throw new Error("Source id, map and url must be supplied as the first three arguments.");if(!n.url)throw new Error("A url must be supplied as part of the flatGeobufOptions object.");if(!n.idProperty)throw new Error("A idProperty must be supplied as part of the flatGeobufOptions object.");this.sourceId=t,this._map=e,this._flatGeobufOptions=Object.assign(n,{minZoom:9}),this._options=r||{},this._fc=this._getBlankFc(),this._map.addSource(t,Object.assign(this._options,{type:"geojson",data:this._fc})),this._maxExtent=[-1/0,1/0,-1/0,1/0],this._tileIds=new Map,this._fcIds=new Map,this.enableRequests(),this._getTileData()}destroySource(){this.disableRequests(),this._map.removeSource(this.sourceId)}disableRequests(){this._map.off("moveend",this._boundEvent)}enableRequests(){this._boundEvent=this._getTileData.bind(this),this._map.on("moveend",this._boundEvent)}_getBlankFc(){return{type:"FeatureCollection",features:[]}}async _getTileData(){if(this._map.getZoom()<this._flatGeobufOptions.minZoom)return;const t=this._map.getBounds().toArray(),e=A.bboxToTile([t[0][0],t[0][1],t[1][0],t[1][1]]),n=[];if(e[2]<this._flatGeobufOptions.minZoom){let r=A.getChildren(e),i=r[0][2];for(;i<this._flatGeobufOptions.minZoom;){const t=[];r.forEach(e=>t.push(...A.getChildren(e))),i=(r=t)[0][2]}for(let e=0;e<r.length;e++){const i=r[e];this._doesTileOverlapBbox(i,t)&&n.push(i)}}else n.push(e);for(let t=0;t<n.length;t++){const e=n[t],r=A.tileToQuadkey(e);this._tileIds.has(r)?(n.splice(t,1),t--):this._tileIds.set(r,!0)}if(0===n.length)return;const r=function(t){let e=1/0,n=-1/0,r=1/0,i=-1/0;for(let o=0;o<t.length;o++){const s=A.tileToBBOX(t[o]);e=Math.min(e,s[0]),n=Math.max(n,s[2]),r=Math.min(r,s[1]),i=Math.max(i,s[3])}return[e,r,n,i]}(n);let i=this._loadData(r);await this.iterateItems(i),this._updateFc()}async iterateItems(t){for await(let e of t)this._fcIds.has(e.properties[this._flatGeobufOptions.idProperty])||(this._fc.features.push(e),this._fcIds.set(e.properties[this._flatGeobufOptions.idProperty]))}_updateFc(t){this._map.getSource(this.sourceId).setData(this._fc)}_doesTileOverlapBbox(t,e){const n=4===t.length?t:A.tileToBBOX(t);return!(n[2]<e[0][0]||n[0]>e[1][0]||n[3]<e[0][1]||n[1]>e[1][1])}_loadData(t){return S(this._flatGeobufOptions.url,function(t){return{minX:t[0],maxX:t[2],minY:t[1],maxY:t[3]}}(t))}}});
